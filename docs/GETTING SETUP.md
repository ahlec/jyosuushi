# Getting Setup

This document is a guide that takes you from cloning the repo, to getting all pieces running on your local machine. This focuses on one-time initial setup; a separate guide will discuss [contributing](CONTRIBUTING.md).

## 1. Install dependencies

This repo uses [yarn](https://yarnpkg.com/) as its package manager to install dependencies. This guide assumes you have `yarn` installed globally ([install guide here](https://yarnpkg.com/getting-started/install)).

Navigate to the cloned repository root in your terminal and run the following command:

```bash
yarn install
```

## 2. Bring up Docker containers

The backend server is powered using a [MariaDB](https://mariadb.org/) database to persist data. This is managed for you in your development environment with [Docker](https://www.docker.com/). This guide assumes you have Docker installed and available via command line.

In your terminal, run the following command:

```bash
docker-compose up
```

Once finished, your database is now available locally on port **1720** with the **root** password of **`example`**. The schema that we use is **`jyosuushi`**.

## 3. Connect with Prisma

Once the Docker container is running, we need to populate the database with our tables. The database is managed with an ORM called [Prisma](https://www.prisma.io/), that autogenerates strong type definitions for the database as well as handling database creation and migrations internally. Prisma was installed as part of the package dependencies.

First, we need to create a **.env** file that will give Prisma the connection string to the database instance. The repository has a template file already filled out with the development information; we'll duplicate that file here.

Open a new terminal instance and navigate to the repository root, then run:

```bash
cd ./prisma
cp dev.env-template .env
```

With this finished, we can now use Prisma to provision our database, creating all of the tables described in the schema file.

```bash
yarn prisma migrate dev --preview-feature
```

You can now use a database explorer to navigate the database, which should be populated with (empty) tables now.

## 4. Create autogenerated files

A number of source files are used to automatically generate other files used in the compilation process. GraphQL documents are used to automatically generate React hooks, Sass files have their TypeScript definitions automatically generated, and so on. These generated files aren't checked into the repository, since they aren't true source files, but they are necessary in order to build the code and run.

In your terminal, run the following command to create all autogenerated files.

```bash
yarn codegen
```

## 5. Start the backend server

Your local environment is now ready to start the backend server. For production environments, you would need to specify a configuration file with various properties, such as URL for the server or email used to send registration emails. However, the development environment is used as the default configuration values, meaning you can start the server without needing to configure anything.

In your terminal, the following command will bring up the backend server.

```bash
yarn start:server
```

Once it tells you that the server is ready, you can access the Apollo GraphQL playground at [http://localhost:4000](http://localhost:4000/). This is also the address that the client will communicate with in local development.

## 6. Create client config file

In order to start the frontend client, you _will_ need to create a config file that's used to hardcode various fields into the client dynamically. Luckily, this also has a development template file, and non-empty values are not a hard requirement.

In a new terminal, navigate to the repository root, and then run the following command.

```bash
cp config.json-template config.json
```

## 7. Start the frontend client

Once you have the config file created, you're ready to start the frontend client. The client is bundled together using [Webpack](https://webpack.js.org/) and the local development server is run with [webpack-dev-server](https://github.com/webpack/webpack-dev-server).

In your terminal, you can start the frontend client with the following command.

```bash
yarn start
```

Compiling the client and hosting it will take a little while. Once the compilation has been completed, you can navigate to the client in your browswer at [http://localhost:8080](http://localhost:8080).

With all of these steps complete, you should find that the client is fully functional and your development environment is ready to go!